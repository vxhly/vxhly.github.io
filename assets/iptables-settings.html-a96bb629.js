import{_ as s,V as e,W as n,Z as i,X as a,$ as t}from"./framework-0ab02afe.js";const r="/assets/iptables-1.png",l="/assets/iptables-2.png",p="/assets/iptables-3.png",o="/assets/iptables-4.png",c="/assets/iptables-5.png",d={},b=a("div",{class:"hint-container tip"},[a("p",{class:"hint-container-title"},"前言"),a("p",null,"本系列笔记又是 Liunx 学习系列教程的一大步, 本系列学习笔记记录 RedHat 系统的安全加固。本篇笔记记录 RedHat 下的防火请的开启和关闭, 还有允许哪些端口通过防火墙。")],-1),v=t(`<h2 id="防火墙的开启和关闭" tabindex="-1"><a class="header-anchor" href="#防火墙的开启和关闭" aria-hidden="true">#</a> 防火墙的开启和关闭</h2><h3 id="永久性生效" tabindex="-1"><a class="header-anchor" href="#永久性生效" aria-hidden="true">#</a> 永久性生效</h3><p>使用 <code>chkconfig</code> , 重启后不会复原</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">chkconfig</span> iptables on         <span class="token comment"># 开启</span>
<span class="token function">chkconfig</span> iptables off        <span class="token comment"># 关闭</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="即时生效" tabindex="-1"><a class="header-anchor" href="#即时生效" aria-hidden="true">#</a> 即时生效</h3><p>使用 <code>service</code> , 重启后复原</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">service</span> iptables start        <span class="token comment"># 开启</span>
<span class="token function">service</span> iptables stop         <span class="token comment"># 关闭</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="iptables-命令解释" tabindex="-1"><a class="header-anchor" href="#iptables-命令解释" aria-hidden="true">#</a> iptables 命令解释</h2><h3 id="选项解释" tabindex="-1"><a class="header-anchor" href="#选项解释" aria-hidden="true">#</a> 选项解释</h3><ul><li><strong>-t&lt;表&gt;</strong>: 指定要操纵的表；</li><li><strong>-A</strong>: 向规则链中添加条目；</li><li><strong>-D</strong>: 从规则链中删除条目；</li><li><strong>-I</strong>: 向规则链中插入条目；</li><li><strong>-R</strong>: 替换规则链中的条目；</li><li><strong>-L</strong>: 显示规则链中已有的条目；</li><li><strong>-F</strong>: 清楚规则链中已有的条目；</li><li><strong>-Z</strong>: 清空规则链中的数据包计算器和字节计数器；</li><li><strong>-N</strong>: 创建新的用户自定义规则链；</li><li><strong>-P</strong>: 定义规则链中的默认目标；</li><li><strong>-h</strong>: 显示帮助信息；</li><li><strong>-p</strong>: 指定要匹配的数据包协议类型；</li><li><strong>-s</strong>: 指定要匹配的数据包源 ip 地址；</li><li><strong>-j&lt;目标&gt;</strong>: 指定要跳转的目标；</li><li><strong>-i&lt;网络接口&gt;</strong>: 指定数据包进入本机的网络接口；</li><li><strong>-o&lt;网络接口&gt;</strong>: 指定数据包要离开本机所使用的网络接口。</li></ul><h3 id="命令输入顺序" tabindex="-1"><a class="header-anchor" href="#命令输入顺序" aria-hidden="true">#</a> 命令输入顺序</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>iptables <span class="token parameter variable">-t</span> 表名 <span class="token operator">&lt;</span>-A/I/D/R<span class="token operator">&gt;</span> 规则链名 <span class="token punctuation">[</span>规则号<span class="token punctuation">]</span> <span class="token operator">&lt;</span>-i/o 网卡名<span class="token operator">&gt;</span> <span class="token parameter variable">-p</span> 协议名 <span class="token operator">&lt;</span>-s 源IP/源子网<span class="token operator">&gt;</span> <span class="token parameter variable">--sport</span> 源端口 <span class="token operator">&lt;</span>-d 目标IP/目标子网<span class="token operator">&gt;</span> <span class="token parameter variable">--dport</span> 目标端口 <span class="token parameter variable">-j</span> 动作
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li><strong>表名包括</strong></li></ul><p>-- <strong>raw</strong>: 高级功能, 如: 网址过滤。 -- <strong>mangle</strong>: 数据包修改（QOS）, 用于实现服务质量。 -- <strong>net</strong>: 地址转换, 用于网关路由器。 -- <strong>filter</strong>: 包过滤, 用于防火墙规则。</p><ul><li><strong>规则链名包括</strong></li></ul><p>-- <strong>INPUT 链</strong>: 处理输入数据包。 -- <strong>OUTPUT 链</strong>: 处理输出数据包。 -- <strong>PORWARD 链</strong>: 处理转发数据包。 -- <strong>PREROUTING 链</strong>: 用于目标地址转换（DNAT）。 -- <strong>POSTOUTING 链</strong>: 用于源地址转换（SNAT）。</p><ul><li><strong>动作包括</strong></li></ul><p>-- <strong>ACCEPT</strong>: 接收数据包。 -- <strong>DROP</strong>: 丢弃数据包。 -- <strong>REDIRECT</strong>: 重定向、映射、透明代理。 -- <strong>SNAT</strong>: 源地址转换。 -- <strong>DNAT</strong>: 目标地址转换。 -- <strong>MASQUERADE</strong>: IP 伪装（NAT）, 用于 ADSL。 -- <strong>LOG</strong>: 日志记录。</p><h2 id="iptables-的设置与查看" tabindex="-1"><a class="header-anchor" href="#iptables-的设置与查看" aria-hidden="true">#</a> iptables 的设置与查看</h2><h3 id="查看-iptables-的设置" tabindex="-1"><a class="header-anchor" href="#查看-iptables-的设置" aria-hidden="true">#</a> 查看 iptables 的设置</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>iptables <span class="token parameter variable">-nL</span>
<span class="token function">service</span> iptables status
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="`+r+`" alt="iptables 的设置与查看" tabindex="0" loading="lazy"><figcaption>iptables 的设置与查看</figcaption></figure><h3 id="清除已有-iptables-规则" tabindex="-1"><a class="header-anchor" href="#清除已有-iptables-规则" aria-hidden="true">#</a> 清除已有 iptables 规则</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>iptables <span class="token parameter variable">-F</span>
iptables <span class="token parameter variable">-X</span>
iptables <span class="token parameter variable">-Z</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="`+l+`" alt="iptables 的设置与查看" tabindex="0" loading="lazy"><figcaption>iptables 的设置与查看</figcaption></figure><h3 id="开放指定的端口" tabindex="-1"><a class="header-anchor" href="#开放指定的端口" aria-hidden="true">#</a> 开放指定的端口</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>iptables <span class="token parameter variable">-A</span> INPUT <span class="token parameter variable">-s</span> <span class="token number">127.0</span>.0.1 <span class="token parameter variable">-d</span> <span class="token number">127.0</span>.0.1 <span class="token parameter variable">-j</span> ACCEPT
<span class="token comment"># 允许本地回环接口(即运行本机访问本机)</span>

iptables <span class="token parameter variable">-A</span> INPUT <span class="token parameter variable">-m</span> state <span class="token parameter variable">--state</span> ESTABLISHED,RELATED <span class="token parameter variable">-j</span> ACCEPT
<span class="token comment"># 允许已建立的或相关连的通行</span>

iptables <span class="token parameter variable">-A</span> OUTPUT <span class="token parameter variable">-j</span> ACCEPT
<span class="token comment"># 允许所有本机向外的访问</span>

iptables <span class="token parameter variable">-A</span> INPUT <span class="token parameter variable">-p</span> tcp <span class="token parameter variable">--dport</span> <span class="token number">22</span> <span class="token parameter variable">-j</span> ACCEPT
<span class="token comment"># 允许访问 22 端口</span>

iptables <span class="token parameter variable">-A</span> INPUT <span class="token parameter variable">-p</span> tcp <span class="token parameter variable">--dport</span> <span class="token number">80</span> <span class="token parameter variable">-j</span> ACCEPT
<span class="token comment"># 允许访问 80 端口</span>

iptables <span class="token parameter variable">-A</span> INPUT <span class="token parameter variable">-p</span> tcp <span class="token parameter variable">--dport</span> <span class="token number">21</span> <span class="token parameter variable">-j</span> ACCEPT
<span class="token comment"># 允许 FTP  服务的 21 端口</span>

iptables <span class="token parameter variable">-A</span> INPUT <span class="token parameter variable">-p</span> tcp <span class="token parameter variable">--dport</span> <span class="token number">20</span> <span class="token parameter variable">-j</span> ACCEPT
<span class="token comment"># 允许 FTP 服务的 20 端口</span>

iptables <span class="token parameter variable">-A</span> INPUT <span class="token parameter variable">-j</span> reject
<span class="token comment"># 禁止其他未允许的规则访问</span>

iptables <span class="token parameter variable">-A</span> FORWARD <span class="token parameter variable">-j</span> REJECT
<span class="token comment"># 禁止其他未允许的规则访问</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="hint-container tip"><p class="hint-container-title">提示</p><p><code>-A</code> 是在 <code>iptables</code> 的最后添加一条规则, <code>-I</code> 是在 <code>iptables</code> 的前面添加一条规则</p></div><figure><img src="`+p+`" alt="iptables 的设置与查看" tabindex="0" loading="lazy"><figcaption>iptables 的设置与查看</figcaption></figure><h3 id="屏蔽-ip" tabindex="-1"><a class="header-anchor" href="#屏蔽-ip" aria-hidden="true">#</a> 屏蔽 IP</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>iptables <span class="token parameter variable">-I</span> INPUT <span class="token parameter variable">-s</span> <span class="token number">123.45</span>.6.7 <span class="token parameter variable">-j</span> DROP
<span class="token comment"># 屏蔽单个 IP 的命令</span>

iptables <span class="token parameter variable">-I</span> INPUT <span class="token parameter variable">-s</span> <span class="token number">123.0</span>.0.0/8 <span class="token parameter variable">-j</span> DROP
<span class="token comment"># 封整个段即从 123.0.0.1 到 123.255.255.254 的命令</span>

iptables <span class="token parameter variable">-I</span> INPUT <span class="token parameter variable">-s</span> <span class="token number">124.45</span>.0.0/16 <span class="token parameter variable">-j</span> DROP
<span class="token comment"># 封 IP 段即从 123.45.0.1 到 123.45.255.254 的命令</span>

iptables <span class="token parameter variable">-I</span> INPUT <span class="token parameter variable">-s</span> <span class="token number">123.45</span>.6.0/24 <span class="token parameter variable">-j</span> DROP
<span class="token comment"># 封 IP 段即从 123.45.6.1 到 123.45.6.254 的命令</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="保存当前设置的规则" tabindex="-1"><a class="header-anchor" href="#保存当前设置的规则" aria-hidden="true">#</a> 保存当前设置的规则</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>/etc/rc.d/init.d/iptables save
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="`+o+'" alt="iptables 的设置与查看" tabindex="0" loading="lazy"><figcaption>iptables 的设置与查看</figcaption></figure><br><figure><img src="'+c+'" alt="iptables 的设置与查看" tabindex="0" loading="lazy"><figcaption>iptables 的设置与查看</figcaption></figure>',36);function m(g,u){return e(),n("div",null,[b,i(" more "),v])}const k=s(d,[["render",m],["__file","iptables-settings.html.vue"]]);export{k as default};
