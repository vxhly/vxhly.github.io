---
author: 星火燎原@vxhly
title: Shell 监听脚本-新增文件
category: [pentest]
tag: [Liunx, Security, Code]
date: 2017-08-22 21:03:18
---

::: tip 前言

Liunx 下的监听 shell 脚本, 脚本功能实现, 当一小时内有新增的新文件, 立刻删除它, 此脚本允许被后台运行。

:::

<!-- more -->

## 功能解释

1. 若含有文件上传漏洞时, 该脚本能够自动删除上传的文件
2. 在 `PWD(攻防对抗)` 中非常有用
3. 后台运行, 只占用进程号, 不占用 shell 界面

## 脚本代码

```shell
#!/bin/bash
while true
do
  find /var/www/dvwa/ -cmin -60 -type f | xargs rm -rf
  sleep 1
done
```

### 脚本解释

- `while true` => 持续监听
- `-cmin -60` => 查找一小时内（包含一小时）新增文件
- `-type f` => 制定文件类型为文件
- `|` => 管道符, 将前一个命令执行结果传送至后一个命令执行
- `xargs` => 命令传递参数的一个过滤器, 可以批量执行
- `sleep 1` => 上一条命令执行之后, 暂停 1 秒
- `/var/www/dvwa/` => 可为任何目录, 这边是一个测试目录

## 运行

```bash
chmod +x [fileName].sh
./[fileName].sh &
```

### 进程号查询

脚本后台运行时, 会生成一个进程号<br>

![Shell 监听脚本](/assets/shell-new-files-1.png)

通过 ps 命令可以查询进程<br>

![Shell 监听脚本](/assets/shell-new-files-2.png)

## 测试

### 本地测试

在 `/var/www/dvwa/` 某个目录下新增文件<br>

![Shell 监听脚本](/assets/shell-new-files-3.png)

### 在有上传文件漏洞中测试

在 dvwa 中的上传文件漏洞环境进行测试<br>

![Shell 监听脚本](/assets/shell-new-files-4.png)
